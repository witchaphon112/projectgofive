<div class="relative inline-block text-left">
  
  <button (click)="toggleDropdown()" 
          class="flex items-center hover:bg-gray-100 py-2 px-3 rounded-lg text-sm transition-colors text-gray-600"
          [class.bg-blue-50]="isOpen() || selectedRoles().length > 0 || selectedStatuses().length > 0"
          [class.text-blue-600]="isOpen() || selectedRoles().length > 0 || selectedStatuses().length > 0">
    <mat-icon class="w-5 h-5">tune</mat-icon>
    
    @if (selectedRoles().length > 0 || selectedStatuses().length > 0) {
      <span class="absolute top-2 right-2 w-2 h-2 bg-red-500 rounded-full"></span>
    }
  </button>

  @if (isOpen()) {
    <div class="absolute right-0 mt-2 w-72 bg-white rounded-xl shadow-xl border border-gray-100 z-50 overflow-hidden animate-in fade-in slide-in-from-top-2 duration-200">
      
      <div class="flex items-center justify-between px-4 py-3 border-b border-gray-100 bg-gray-50/50">
        <h3 class="font-semibold text-gray-700">Filters</h3>
        <button (click)="resetFilters()" class="text-xs text-gray-400 hover:text-red-500 font-medium">
          Reset all
        </button>
      </div>

      <div class="p-4 space-y-5 max-h-[60vh] overflow-y-auto">
        
        @if (showRoles && availableRoles.length > 0) {
          <div>
            <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 block">By Role</label>
            <div class="space-y-2">
              @for (role of availableRoles; track role) {
                <label class="flex items-center cursor-pointer group">
                  <div class="relative flex items-center">
                    <input type="checkbox" 
                           class="peer sr-only" 
                           [checked]="isRoleSelected(role)"
                           (change)="toggleRole(role)">
                    <div class="w-5 h-5 border-2 border-gray-300 rounded transition-colors peer-checked:bg-[#0794FF] peer-checked:border-[#0794FF] bg-white"></div>
                    <mat-icon class="absolute top-0 left-0 w-5 h-5 text-white opacity-0 peer-checked:opacity-100 text-[16px] leading-none flex items-center justify-center pointer-events-none">check</mat-icon>
                  </div>
                  <span class="ml-2 text-sm text-gray-600 group-hover:text-gray-900">{{ role }}</span>
                </label>
              }
            </div>
          </div>
        }

        @if (showStatuses && availableStatuses.length > 0) {
          <div>
            <label class="text-xs font-bold text-gray-400 uppercase tracking-wider mb-2 block">By Status</label>
            <div class="space-y-2">
              @for (status of availableStatuses; track status) {
                <label class="flex items-center cursor-pointer group">
                  <div class="relative flex items-center">
                    <input type="checkbox" 
                           class="peer sr-only" 
                           [checked]="isStatusSelected(status)"
                           (change)="toggleStatus(status)">
                    <div class="w-5 h-5 border-2 border-gray-300 rounded transition-colors peer-checked:bg-[#0794FF] peer-checked:border-[#0794FF] bg-white"></div>
                    <mat-icon class="absolute top-0 left-0 w-5 h-5 text-white opacity-0 peer-checked:opacity-100 text-[16px] leading-none flex items-center justify-center pointer-events-none">check</mat-icon>
                  </div>
                  <span class="ml-2 text-sm text-gray-600 group-hover:text-gray-900">{{ status }}</span>
                </label>
              }
            </div>
          </div>
        }

      </div>

      <div class="p-3 border-t border-gray-100 bg-gray-50">
        <button (click)="applyFilters()" class="w-full py-2 bg-[#4A85F6] hover:bg-[#335daa] text-white rounded-lg text-sm font-medium transition-colors shadow-sm">
          Apply Filters
        </button>
      </div>

    </div>
  }

  @if (isOpen()) {
    <div (click)="isOpen.set(false)" class="fixed inset-0 z-40 bg-transparent cursor-default"></div>
  }

</div>