<div class="flex flex-col min-h-[calc(100vh-140px)]">
  <h1 class="text-[28px] font-semibold text-[#0794FF] mb-6">Users Dashboard</h1>

  <div class="flex flex-col md:flex-row items-center mb-6 space-y-4 md:space-y-0 md:space-x-4">
    <div class="relative w-full md:flex-1">
      <app-search-input (searchChange)="onSearch($event)"></app-search-input>
    </div>
    
    <div class="flex items-center gap-3"> 
      <button 
        (click)="openAddUser()" 
        [disabled]="!canCreateUsers"
        class="flex items-center gap-1 px-5 py-2.5 rounded-md text-sm font-medium transition-colors"
        [ngClass]="{
          'bg-[#4A85F6] hover:bg-[#335daa] text-white': canCreateUsers,
          'bg-gray-300 text-gray-500 cursor-not-allowed': !canCreateUsers
        }">
        Add user <mat-icon class="text-lg">add</mat-icon>
      </button>
      <app-sort-by (sortChange)="onSortChange($event)"></app-sort-by>
      <app-saved-search [savedSearches]="savedSearches" (searchSelected)="onSavedSearch($event)"></app-saved-search>
      <app-fillter 
        [availableStatuses]="availableStatuses()"
        [availableRoles]="availableRoles()"
        (filterChange)="onFilterChange($event)">
      </app-fillter>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow-sm overflow-hidden mb-4">
    <div class="px-6 py-2  border-gray-200">
      <h2 class="text-lg font-semibold text-gray-900 m-0">List Users</h2>
    </div>

    <div class="overflow-x-auto">
      <table class="w-full border-collapse">
        <thead class="bg-[#EFF4FA]">
          <tr class="h-14">
            <th class="px-6 py-3 text-left text-xs font-semibold text-[#8F9BB3] uppercase tracking-wider">Name</th>
            <th class="px-6 py-3 text-left text-xs font-semibold text-[#8F9BB3] uppercase tracking-wider"></th>
            <th class="px-6 py-3 text-left text-xs font-semibold text-[#8F9BB3] uppercase tracking-wider">Create Date</th>
            <th class="px-6 py-3 text-left text-xs font-semibold text-[#8F9BB3] uppercase tracking-wider">Role</th>
            <th class="px-12 py-3 text-right text-xs font-semibold text-[#8F9BB3] uppercase tracking-wider">Action</th>
            
          </tr>
        </thead>
        
        <tbody class="bg-white divide-y divide-gray-100">
          @for (user of filteredUsers(); track user.id) {
            
            <tr class="hover:bg-gray-50 transition-colors">
              <td class="px-16 py-4 min-w-[200px]">
                <div class="font-medium text-gray-900 mb-1">{{ user.firstName }} {{ user.lastName }}</div>
                <div class="text-sm text-gray-500">{{ user.email }}</div>
              </td>
              <td></td>
              <td class="px-6 py-4 whitespace-nowrap text-gray-500">
                {{ user.createDate | date: 'd MMM, y' }}
              </td>
              
              <td class="px-6 py-4 whitespace-nowrap">
                <span class="inline-block px-3 py-1.5 rounded-2xl text-xs font-medium"
                      [ngClass]="{
                        'bg-[#4A85F6] text-white': user.role === 'Super Admin' || user.role === 'Admin' || user.role === 'HR Admin',
                        'bg-gray-200 text-gray-700': user.role === 'Employee'
                      }">
                  {{ user.role }}
                </span>
              </td>

              <td class="px-6 py-4 whitespace-nowrap text-right">
                <button 
                  (click)="onEdit(user)" 
                  [disabled]="!canEditUsers"
                  class="inline-flex items-center justify-center p-2 rounded transition-colors ml-2"
                  [ngClass]="{
                    'text-[#C5CEE0] hover:bg-gray-100 hover:text-[#0794FF]': canEditUsers,
                    'text-[#C5CEE0] cursor-not-allowed opacity-30': !canEditUsers
                  }"
                  title="Edit">
                  <mat-icon class="text-xl">edit</mat-icon>
                </button>
                
                <button 
                  (click)="onDelete(user)" 
                  [disabled]="!canDeleteUsers"
                  class="inline-flex items-center justify-center p-2 rounded transition-colors"
                  [ngClass]="{
                    'text-[#C5CEE0] hover:bg-gray-100 hover:text-red-600': canDeleteUsers,
                    'text-[#C5CEE0] cursor-not-allowed opacity-30': !canDeleteUsers
                  }"
                  title="Delete">
                  <mat-icon class="text-xl">delete</mat-icon>
                </button>
              </td>
            </tr>
          } @empty {
            <tr>
              <td colspan="4" class="px-6 py-12 text-center text-gray-500 text-sm">
                @if (isLoading()) {
                  Loading users...
                } @else if (searchQuery()) {
                  No users found matching "{{ searchQuery() }}"
                } @else {
                  No users found
                }
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  </div>

  <div class="mt-auto">
    @if (totalCount() > 0) {
      <app-slide
        [currentPage]="currentPage()"
        [pageSize]="pageSize()"
        [totalCount]="totalCount()"
        [isLoading]="isLoading()"
        (pageChange)="onPageChange($event)"
        (pageSizeChange)="onPageSizeChange($event)">
      </app-slide>
    }
  </div>
</div>